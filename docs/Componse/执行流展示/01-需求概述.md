# Agent Execution Stream - 执行流展示

## 1. 功能概述

**Agent Execution Stream（执行流展示）** 是 Agent 执行过程中的实时状态展示系统，让用户能够清晰地了解 Agent 正在做什么、进度如何、以及中间结果。

### 1.1 功能命名

| 英文名称 | 中文名称 | 说明 |
|---------|---------|------|
| Agent Execution Stream | 执行流展示 | 完整功能名称 |
| Runtime Display | 运行时展示 | 备选名称 |
| Execution Visualization | 执行可视化 | 备选名称 |

### 1.2 核心展示内容

```
┌─────────────────────────────────────────────────────────────────┐
│  思考过程展示 (Thinking Display) [默认收起，ctrl+t 展开]          │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━                                │
│  ▼ Thinking                                                      │
│  │ Let me analyze the codebase structure...                     │
│  └──────────────────────────────────────                        │
│                                                                  │
│  工具调用展示 (Tool Call Display)                                 │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━                                │
│  ● Read(src/components/app.tsx)                                  │
│    └ Read 156 lines from src/components/app.tsx                 │
│                                                                  │
│  ● Glob(**/*.tsx)                                                │
│    └ Found 23 files matching pattern                             │
│                                                                  │
│  状态指示器 (Status Indicator)                                    │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━                                │
│  * Thinking... (esc to interrupt · 32s · ↓ 786 tokens)          │
│    └ Tip: Press ctrl+t to show thinking process                 │
└─────────────────────────────────────────────────────────────────┘
```

### 1.3 参考项目对比

| 功能 | Claude Code | gemini-cli | opencode |
|------|-------------|------------|----------|
| 状态指示器 | ✅ 完善 | ✅ 完善 | ✅ 基础 |
| 工具调用展示 | ✅ 详细 | ✅ 详细 | ✅ 基础 |
| 思考过程 | ✅ 可展开 | ✅ 支持 | ❌ 无 |
| Token 统计 | ✅ 实时 | ✅ 实时 | ❌ 无 |
| 执行时间 | ✅ 显示 | ✅ 显示 | ❌ 无 |
| Tip 提示 | ✅ 轮播 | ❌ 无 | ❌ 无 |

## 2. 设计目标

### 2.1 用户体验目标

1. **实时反馈** - 用户始终知道 Agent 在做什么
2. **信息层次** - 重要信息突出，次要信息可选查看
3. **可控性** - 用户可以中断、展开/收起、查看详情
4. **性能优化** - 不影响终端渲染性能

### 2.2 技术目标

1. **Core/CLI 分层** - 状态管理在 Core，UI 渲染在 CLI
2. **事件驱动** - 通过事件系统解耦状态和展示
3. **主题适配** - 颜色完全基于主题系统
4. **组件化** - 可复用的独立组件

## 3. 功能模块

| 模块 | 功能 | 优先级 |
|------|------|--------|
| **StatusIndicator** | 状态指示器（Spinner + 状态词 + 时间 + Token） | P0 |
| **ToolCallDisplay** | 工具调用展示（工具名 + 参数 + 结果） | P0 |
| **ThinkingDisplay** | 思考过程展示（推理模型的 thinking） | P1 |
| **TipDisplay** | 操作提示轮播 | P1 |
| **LiveOutput** | 长时间工具的实时输出 | P2 |
| **ExpandableDetail** | 可展开的详细内容 | P2 |

## 4. 快捷键设计

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `ctrl+t` | 切换思考展示 | Toggle thinking display |
| `esc` | 中断执行 | Interrupt current execution |
| `ctrl+c` | 强制中断 | Force cancel |

## 5. 实现优先级

### Phase 1 (P0) - 核心功能
- [ ] 状态指示器组件
- [ ] 工具调用展示组件
- [ ] 执行流 Context
- [ ] 基础事件系统

### Phase 2 (P1) - 增强功能
- [ ] 思考过程展示（默认收起）
- [ ] ctrl+t 快捷键切换
- [ ] Tip 提示轮播
- [ ] Token 统计显示

### Phase 3 (P2) - 完善功能
- [ ] 实时输出流
- [ ] 展开/折叠详情
- [ ] 工具调用历史
- [ ] 性能优化
