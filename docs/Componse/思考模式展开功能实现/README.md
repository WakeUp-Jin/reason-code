# 思考模式展开功能实现

## 📐 功能概述

实现 `ctrl+o` 快捷键切换思考内容的展开/折叠状态：

| 状态             | 思考内容显示       | 输入框  | 底部提示                                         |
| ---------------- | ------------------ | ------- | ------------------------------------------------ |
| **折叠**（默认） | 最多 2 行 + 省略号 | ✅ 显示 | `[ctrl+o to expand]`                             |
| **展开**         | 完整内容           | ❌ 隐藏 | `Showing detailed transcript · ctrl+o to toggle` |

## 📁 文档目录

1. [01-问题分析与挑战.md](./01-问题分析与挑战.md) - 核心问题和技术挑战
2. [02-失败方案复盘.md](./02-失败方案复盘.md) - 尝试过的方案及失败原因
3. [03-最终解决方案.md](./03-最终解决方案.md) - 成功方案的详细实现
4. [04-关键代码解析.md](./04-关键代码解析.md) - 核心代码逐行分析
5. [05-经验总结.md](./05-经验总结.md) - 学到的经验和最佳实践

## 🎯 核心难点

这个功能看似简单，但涉及到 **Ink 框架的 Static 组件特性** 和 **终端渲染机制** 的深层问题：

```
用户期望：按 ctrl+o → 屏幕刷新 → 显示完整/折叠内容
实际挑战：Static 组件输出后变成终端历史，无法被 React 控制
```

## ✅ 最终方案：Remount + 屏幕缓冲区切换

```
ctrl+o → 更新持久化状态 → unmount Ink → 切换屏幕缓冲区 → 重新 render
```

这个方案成功的关键是：**利用终端的备用屏幕缓冲区（Alternate Screen Buffer）实现彻底清屏**。
