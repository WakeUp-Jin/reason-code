# 00 - æ¶æ„è°ƒæ•´è¯´æ˜

> ä»å•ä½“ CLI åˆ° Monorepo + Core/CLI åˆ†å±‚æ¶æ„
>
> æ—¥æœŸï¼š2025-12-23

---

## ğŸ“‹ é‡è¦è¯´æ˜

æ ¹æ®é¡¹ç›®å®é™…çš„ **Monorepo + Core/CLI åˆ†å±‚æ¶æ„**ï¼Œæˆ‘ä»¬éœ€è¦å¯¹åŸæœ‰çš„å¼€å‘æ–‡æ¡£è¿›è¡Œè°ƒæ•´ã€‚

---

## ğŸ”„ æ¶æ„å˜åŒ–

### åŸæœ‰æ¶æ„ï¼ˆé”™è¯¯å‡è®¾ï¼‰

```
my-cli-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ cli/           # CLI å…¥å£
â”‚   â”œâ”€â”€ agent/         # Agent å±‚
â”‚   â”œâ”€â”€ storage/       # å­˜å‚¨å±‚
â”‚   â”œâ”€â”€ ui/            # UI ç»„ä»¶
â”‚   â””â”€â”€ contexts/      # ä¸Šä¸‹æ–‡
â””â”€â”€ package.json
```

**é—®é¢˜**ï¼šå‡è®¾æ˜¯å•ä½“é¡¹ç›®ï¼Œæ‰€æœ‰ä»£ç åœ¨ä¸€ä¸ªåŒ…ä¸­ã€‚

### å®é™…æ¶æ„ï¼ˆMonorepo - ç®€åŒ–ç‰ˆï¼‰

**æ–°é¡¹ç›®å»ºè®®ä½¿ç”¨çš„ç®€æ´ç»“æ„**ï¼š

```
my-project/                      # æ ¹ç›®å½•
â”œâ”€â”€ package.json                 # æ ¹é…ç½®ï¼ˆworkspacesï¼‰
â”œâ”€â”€ turbo.json                   # Turbo æ„å»ºé…ç½®
â””â”€â”€ packages/
    â”œâ”€â”€ cli/                     # ğŸ–¥ï¸  CLI åŒ…ï¼ˆTUIç•Œé¢å±‚ï¼‰
    â”‚   â”œâ”€â”€ src/
    â”‚   â”‚   â”œâ”€â”€ tui/            # ç»ˆç«¯ UI
    â”‚   â”‚   â”‚   â”œâ”€â”€ app.tsx
    â”‚   â”‚   â”‚   â”œâ”€â”€ routes/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ home.tsx
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ session/
    â”‚   â”‚   â”‚   â”œâ”€â”€ ui/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dialog-select.tsx
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ toast.tsx
    â”‚   â”‚   â”‚   â”œâ”€â”€ component/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ prompt/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dialog-command.tsx
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
    â”‚   â”‚   â”‚   â””â”€â”€ context/
    â”‚   â”‚   â”‚       â”œâ”€â”€ theme.tsx
    â”‚   â”‚   â”‚       â”œâ”€â”€ store.tsx
    â”‚   â”‚   â”‚       â””â”€â”€ dialog.tsx
    â”‚   â”‚   â””â”€â”€ index.ts         # CLI å…¥å£
    â”‚   â””â”€â”€ package.json
    â”‚       â””â”€â”€ dependencies:
    â”‚           â””â”€â”€ "@my-project/core": "workspace:*"
    â”‚
    â””â”€â”€ core/                    # ğŸ§  Core åŒ…ï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰
        â”œâ”€â”€ src/
        â”‚   â”œâ”€â”€ session/         # Session ç®¡ç†
        â”‚   â”œâ”€â”€ agent/           # Agent å¼•æ“
        â”‚   â”œâ”€â”€ storage/         # æŒä¹…åŒ–
        â”‚   â”œâ”€â”€ bus/             # äº‹ä»¶æ€»çº¿
        â”‚   â””â”€â”€ index.ts
        â””â”€â”€ package.json
            â””â”€â”€ exports:
                â””â”€â”€ "./*": "./src/*.ts"
```

**è¯´æ˜**ï¼š
- **åªæœ‰ 2 ä¸ªæ ¸å¿ƒåŒ…**ï¼š`cli` å’Œ `core`
- `cli` åŒ…å«æ‰€æœ‰ TUI ç›¸å…³ä»£ç 
- `core` åŒ…å«æ‰€æœ‰ä¸šåŠ¡é€»è¾‘
- æ›´ç®€æ´ï¼Œæ›´æ˜“ç†è§£

---

## ğŸ¯ æ ¸å¿ƒè°ƒæ•´ç‚¹

### 1. åŒ…ç»“æ„è°ƒæ•´

| åŸæ–‡æ¡£å‡è®¾ | å®é™…æ¶æ„ | è¯´æ˜ |
|-----------|---------|------|
| `src/agent/` | `packages/core/src/agent/` | Agent é€»è¾‘åœ¨ core åŒ… |
| `src/storage/` | `packages/core/src/storage/` | Storage åœ¨ core åŒ… |
| `src/bus/` | `packages/core/src/bus/` | äº‹ä»¶æ€»çº¿åœ¨ core åŒ… |
| `src/ui/` | `packages/cli/src/tui/ui/` | UI åœ¨ cli åŒ… |
| `src/contexts/` | `packages/cli/src/tui/context/` | Context åœ¨ cli åŒ… |
| `src/components/` | `packages/cli/src/tui/component/` | ç»„ä»¶åœ¨ cli åŒ… |
| `src/routes/` | `packages/cli/src/tui/routes/` | è·¯ç”±åœ¨ cli åŒ… |

### 2. ä¾èµ–å…³ç³»è°ƒæ•´

```typescript
// âŒ åŸæ–‡æ¡£å‡è®¾ï¼ˆåŒä¸€åŒ…å†…å¯¼å…¥ï¼‰
import { Agent } from '@/agent'
import { Storage } from '@/storage'
import { useStore } from '@/contexts/store'

// âœ… å®é™…æ¶æ„ï¼ˆè·¨åŒ…å¯¼å…¥ï¼‰
// åœ¨ packages/cli/ ä¸­ï¼š
import { Session } from '@my-project/core/session'
import { Storage } from '@my-project/core/storage'
import { Bus } from '@my-project/core/bus'

// åŒåŒ…å†…å¯¼å…¥ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
import { useStore } from './context/store'
import { DialogSelect } from './ui/dialog-select'
```

### 3. ç›®å½•ç»“æ„è°ƒæ•´

```
åŸæ–‡æ¡£ç›®å½•ç»“æ„ï¼ˆå•ä½“é¡¹ç›®ï¼‰ï¼š
src/
â”œâ”€â”€ cli/main.tsx
â”œâ”€â”€ routes/
â”œâ”€â”€ ui/
â”œâ”€â”€ components/
â”œâ”€â”€ contexts/
â”œâ”€â”€ agent/          â† åº”è¯¥åœ¨ core åŒ…
â”œâ”€â”€ storage/        â† åº”è¯¥åœ¨ core åŒ…
â”œâ”€â”€ bus/            â† åº”è¯¥åœ¨ core åŒ…
â””â”€â”€ themes/

å®é™…ç›®å½•ç»“æ„ï¼ˆMonorepoï¼‰ï¼š
packages/
â”œâ”€â”€ cli/            # CLI åŒ…ï¼ˆTUI ç•Œé¢ï¼‰
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ tui/
â”‚       â”‚   â”œâ”€â”€ app.tsx
â”‚       â”‚   â”œâ”€â”€ routes/
â”‚       â”‚   â”‚   â”œâ”€â”€ home.tsx
â”‚       â”‚   â”‚   â””â”€â”€ session/
â”‚       â”‚   â”œâ”€â”€ ui/
â”‚       â”‚   â”‚   â”œâ”€â”€ dialog-select.tsx
â”‚       â”‚   â”‚   â””â”€â”€ toast.tsx
â”‚       â”‚   â”œâ”€â”€ component/
â”‚       â”‚   â”‚   â”œâ”€â”€ prompt/
â”‚       â”‚   â”‚   â”œâ”€â”€ dialog-command.tsx
â”‚       â”‚   â”‚   â””â”€â”€ ...
â”‚       â”‚   â”œâ”€â”€ context/
â”‚       â”‚   â”‚   â”œâ”€â”€ theme.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ store.tsx
â”‚       â”‚   â”‚   â””â”€â”€ dialog.tsx
â”‚       â”‚   â””â”€â”€ themes/
â”‚       â””â”€â”€ index.ts
â”‚
â””â”€â”€ core/           # Core åŒ…ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
    â””â”€â”€ src/
        â”œâ”€â”€ session/
        â”œâ”€â”€ agent/
        â”œâ”€â”€ storage/
        â”œâ”€â”€ bus/
        â””â”€â”€ index.ts
```

---

## ğŸ“š æ–‡æ¡£æ›´æ–°ç­–ç•¥

### ä¿æŒä¸å˜çš„éƒ¨åˆ†

ä»¥ä¸‹å†…å®¹**ä¸éœ€è¦è°ƒæ•´**ï¼Œå› ä¸ºå®ƒä»¬æ˜¯é€šç”¨çš„å®ç°é€»è¾‘ï¼š

1. âœ… **UI ç»„ä»¶å®ç°** (03-æ ¸å¿ƒUIç»„ä»¶å®ç°æŒ‡å—.md)
   - DialogSelectã€Promptã€Dialog ç³»ç»Ÿ
   - Ink ç»„ä»¶ç”¨æ³•
   - å¸ƒå±€ç»„ä»¶è®¾è®¡

2. âœ… **ä¸»é¢˜ç³»ç»Ÿ** (04-ä¸»é¢˜ç³»ç»Ÿè®¾è®¡.md)
   - ä¸»é¢˜ JSON æ ¼å¼
   - é¢œè‰²ç³»ç»Ÿ
   - ç»ˆç«¯æ£€æµ‹

### éœ€è¦è°ƒæ•´çš„éƒ¨åˆ†

1. âš ï¸ **01-æ•´ä½“æ¶æ„è®¾è®¡.md**
   - æ›´æ–°ä¸º Monorepo æ¶æ„
   - è°ƒæ•´ç›®å½•ç»“æ„
   - æ›´æ–°ä¾èµ–å…³ç³»

2. âš ï¸ **02-æ•°æ®æµå’ŒçŠ¶æ€ç®¡ç†.md**
   - æ›´æ–° import è·¯å¾„
   - è°ƒæ•´æ¨¡å—å¼•ç”¨
   - Storage å±‚åœ¨ SDK åŒ…

---

## ğŸ› ï¸ å®é™…å¼€å‘æŒ‡å—

### 1. é¡¹ç›®åˆå§‹åŒ–

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
cd /Users/xjk/Desktop/ScriptCode/opencode

# å®‰è£…ä¾èµ–ï¼ˆå·²æœ‰ï¼‰
bun install

# æŸ¥çœ‹åŒ…ç»“æ„
ls packages/
```

### 2. CLI åŒ…å¼€å‘

```bash
# è¿›å…¥ CLI åŒ…
cd packages/cli

# å¼€å‘æ¨¡å¼
bun run dev

# TUI ä»£ç ä½ç½®
cd src/tui
```

### 3. è·¨åŒ…å¯¼å…¥

```typescript
// åœ¨ packages/cli/src/tui/app.tsx

// âœ… å¯¼å…¥ core åŒ…
import { Session } from '@my-project/core/session'
import { Storage } from '@my-project/core/storage'
import { Bus } from '@my-project/core/bus'

// âœ… åŒåŒ…å¯¼å…¥ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
import { useTheme } from './context/theme'
import { DialogSelect } from './ui/dialog-select'
```

### 4. æ·»åŠ æ–°åŠŸèƒ½

```bash
# å¦‚æœæ˜¯ UI ç»„ä»¶ â†’ åœ¨ cli åŒ…
packages/cli/src/tui/component/my-component.tsx

# å¦‚æœæ˜¯ä¸šåŠ¡é€»è¾‘ â†’ åœ¨ core åŒ…
packages/core/src/feature/my-feature.ts
```

---

## ğŸ“– æ›´æ–°åçš„å­¦ä¹ è·¯çº¿

### ç¬¬ä¸€é˜¶æ®µï¼šç†è§£ Monorepoï¼ˆ1 å¤©ï¼‰

1. **é˜…è¯»**ï¼š
   - `/Users/xjk/Desktop/ScriptCode/opencode/mydocs/é¡¹ç›®çš„æ¶æ„è®¾è®¡/README.md`
   - `/Users/xjk/Desktop/ScriptCode/opencode/mydocs/é¡¹ç›®çš„æ¶æ„è®¾è®¡/02-Core+CLIåˆ†å±‚æ¶æ„.md`

2. **é‡ç‚¹ç†è§£**ï¼š
   - Workspaces æœºåˆ¶
   - ç¬¦å·é“¾æ¥ï¼ˆSymlinkï¼‰
   - æºç æš´éœ²ï¼ˆ`.ts` ç›´æ¥å¯¼å…¥ï¼‰
   - Core/CLI åˆ†å±‚

### ç¬¬äºŒé˜¶æ®µï¼šç†è§£ CLI æ¶æ„ï¼ˆ1 å¤©ï¼‰

1. **é˜…è¯»**ï¼š
   - `01-æ•´ä½“æ¶æ„è®¾è®¡.md`ï¼ˆæ›´æ–°åï¼‰
   - `02-æ•°æ®æµå’ŒçŠ¶æ€ç®¡ç†.md`ï¼ˆæ›´æ–°åï¼‰

2. **é‡ç‚¹ç†è§£**ï¼š
   - CLI å¦‚ä½•ä½¿ç”¨ SDK
   - TUI ç›®å½•ç»“æ„
   - äº‹ä»¶æ€»çº¿ï¼ˆåœ¨ SDK ä¸­ï¼‰

### ç¬¬ä¸‰é˜¶æ®µï¼šUI å¼€å‘ï¼ˆ3-5 å¤©ï¼‰

1. **é˜…è¯»**ï¼š
   - `03-æ ¸å¿ƒUIç»„ä»¶å®ç°æŒ‡å—.md`
   - `04-ä¸»é¢˜ç³»ç»Ÿè®¾è®¡.md`

2. **å®è·µ**ï¼š
   - åœ¨ `packages/opencode/src/cli/cmd/tui/` å¼€å‘
   - å‚è€ƒç°æœ‰ç»„ä»¶å®ç°

---

## ğŸ¯ å…³é”®å·®å¼‚æ€»ç»“

| ç»´åº¦ | åŸå‡è®¾ | å®é™…æ¶æ„ |
|------|--------|---------|
| **é¡¹ç›®ç»“æ„** | å•ä½“é¡¹ç›® | Monorepoï¼ˆ2 åŒ…ï¼‰ |
| **åŒ…æ•°é‡** | 1 ä¸ª | 2 ä¸ªï¼ˆcli + coreï¼‰ |
| **Agent ä½ç½®** | `src/agent/` | `packages/core/src/agent/` |
| **Storage ä½ç½®** | `src/storage/` | `packages/core/src/storage/` |
| **UI ä½ç½®** | `src/ui/` | `packages/cli/src/tui/ui/` |
| **å¯¼å…¥æ–¹å¼** | `@/agent` | `@my-project/core/agent` |
| **å¼€å‘ç›®å½•** | `src/` | `packages/cli/src/tui/` |

---

## âœ… è¡ŒåŠ¨å»ºè®®

### ç«‹å³è¡ŒåŠ¨

1. âœ… é˜…è¯»æœ¬è°ƒæ•´è¯´æ˜
2. âœ… é˜…è¯» Monorepo æ¶æ„æ–‡æ¡£ï¼ˆ`/mydocs/é¡¹ç›®çš„æ¶æ„è®¾è®¡/`ï¼‰
3. âœ… æŸ¥çœ‹å®é™…é¡¹ç›®ç›®å½•ç»“æ„ï¼ˆ`packages/`ï¼‰
4. âœ… ç†è§£è·¨åŒ…ä¾èµ–å…³ç³»

### å¼€å‘æ—¶æ³¨æ„

1. **æ˜ç¡®å½“å‰åœ¨å“ªä¸ªåŒ…**ï¼š
   - CLI UI ä»£ç  â†’ `packages/cli/src/tui/`
   - ä¸šåŠ¡é€»è¾‘ â†’ `packages/core/src/`

2. **æ­£ç¡®å¯¼å…¥**ï¼š
   - è·¨åŒ…ï¼š`@my-project/core/xxx`
   - åŒåŒ…ï¼šç›¸å¯¹è·¯å¾„ `./xxx`

3. **å‚è€ƒç°æœ‰ä»£ç **ï¼š
   - å‚è€ƒ OpenCode é¡¹ç›®ï¼š`packages/opencode/src/cli/cmd/tui/`
   - æ¨¡ä»¿ç°æœ‰çš„ import å†™æ³•

---

## ğŸ“ æ–‡æ¡£æ›´æ–°è®¡åˆ’

- â³ æ›´æ–° `01-æ•´ä½“æ¶æ„è®¾è®¡.md` - åæ˜  Monorepo ç»“æ„
- â³ æ›´æ–° `02-æ•°æ®æµå’ŒçŠ¶æ€ç®¡ç†.md` - è°ƒæ•´å¯¼å…¥è·¯å¾„
- âœ… ä¿æŒ `03-æ ¸å¿ƒUIç»„ä»¶å®ç°æŒ‡å—.md` - æ— éœ€è°ƒæ•´
- âœ… ä¿æŒ `04-ä¸»é¢˜ç³»ç»Ÿè®¾è®¡.md` - æ— éœ€è°ƒæ•´
- â³ æ›´æ–° `README.md` - æ·»åŠ  Monorepo è¯´æ˜

---

**é‡è¦æç¤º**ï¼šé˜…è¯»æœ¬æ–‡æ¡£åï¼Œè¯·å…ˆæµè§ˆ `/mydocs/é¡¹ç›®çš„æ¶æ„è®¾è®¡/` ä¸­çš„ Monorepo ç›¸å…³æ–‡æ¡£ï¼Œå†ç»§ç»­é˜…è¯» CLI å¼€å‘æ–‡æ¡£ï¼

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.1
**æœ€åæ›´æ–°**ï¼š2025-12-23
