# å†™å…¥å·¥å…·çŠ¶æ€ä¸å˜é—®é¢˜åˆ†æ

## é—®é¢˜ç°è±¡

æ‰§è¡Œ WriteFile å·¥å…·åï¼š
- å·¥å…·å›¾æ ‡ä¿æŒé»„è‰² `â—‹`ï¼ˆpending çŠ¶æ€ï¼‰
- ä¸æ˜¾ç¤ºæ‰§è¡Œç»“æœå’Œè€—æ—¶
- é¢œè‰²æ²¡æœ‰å˜æˆç»¿è‰² `â—`ï¼ˆsuccess çŠ¶æ€ï¼‰

è€Œ ReadFile å·¥å…·æ˜¾ç¤ºæ­£å¸¸ï¼ˆç»¿è‰² `â—`ï¼Œæ˜¾ç¤ºç»“æœï¼‰ã€‚

## é—®é¢˜æˆªå›¾

```
â—‹ WriteFile (test5jinkang.ts)    â† é»„è‰²ï¼Œpending çŠ¶æ€ï¼Œæ²¡æœ‰æ›´æ–°

æ–‡ä»¶å·²æˆåŠŸå†™å…¥ï¼...

â— ReadFile (test5jinkang.ts) Â· 1ms   â† ç»¿è‰²ï¼Œsuccess çŠ¶æ€ï¼Œæ­£å¸¸
â”” Read 28 lines from test5jinkang.ts
```

## æ ¹æœ¬åŸå› 

### 1. Ink çš„ `<Static>` ç»„ä»¶ç‰¹æ€§

`<Static>` æ˜¯ Ink æä¾›çš„ç‰¹æ®Šç»„ä»¶ï¼Œç”¨äºæ˜¾ç¤º"æ‰“å°åå›ºå®š"çš„å†…å®¹ã€‚**ä¸€æ—¦æ¸²æŸ“åå°±ä¸ä¼šæ›´æ–°**ï¼Œè¿™æ˜¯å…¶è®¾è®¡ç‰¹æ€§ã€‚

```tsx
// packages/cli/src/routes/session/index.tsx
<Static items={staticItems}>
  {(item: StaticItem) => {
    // ... æ¸²æŸ“æ¶ˆæ¯
    case 'tool':
      return <ToolMessage message={item.message} />;
  }}
</Static>
```

### 2. å·¥å…·æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸ

1. **tool:validating äº‹ä»¶**ï¼šå·¥å…·æ¶ˆæ¯è¢«åˆ›å»ºï¼ŒçŠ¶æ€ä¸º `pending`
2. æ¶ˆæ¯è¢«æ·»åŠ åˆ° storeï¼Œ`isStreaming: false`
3. `useCompletedMessages()` è¿”å›è¯¥æ¶ˆæ¯ï¼ˆå› ä¸º `!m.isStreaming`ï¼‰
4. `<Static>` æ¸²æŸ“è¯¥æ¶ˆæ¯ï¼Œæ˜¾ç¤º `pending` çŠ¶æ€ï¼ˆé»„è‰² `â—‹`ï¼‰
5. **tool:complete äº‹ä»¶**ï¼šstore ä¸­çš„çŠ¶æ€æ›´æ–°ä¸º `success`
6. **ä½†æ˜¯ `<Static>` ä¸ä¼šé‡æ–°æ¸²æŸ“å·²æ‰“å°çš„å†…å®¹ï¼**

### 3. ä¸ºä»€ä¹ˆ ReadFile æ˜¾ç¤ºæ­£å¸¸ï¼Ÿ

ReadFile æ˜¯åœ¨ WriteFile æ‰§è¡Œå®Œæˆåæ‰è¢«æ·»åŠ çš„ã€‚å½“å®ƒè¢«æ·»åŠ åˆ° `<Static>` æ—¶ï¼Œå·²ç»æ˜¯ `success` çŠ¶æ€äº†ï¼Œæ‰€ä»¥æ˜¾ç¤ºæ­£å¸¸ã€‚

## æ—¥å¿—è¯æ®

### CLI æ—¥å¿—

```log
[18:54:43.732] ğŸ“¡ Event received {"eventType":"tool:complete",...}
[18:54:43.732] ğŸ”§ Tool complete event - DEBUG {
  "toolName": "WriteFile",
  "originalStatus": "success",   â† çŠ¶æ€ç¡®å®æ˜¯ success
  "mappedStatus": "success",     â† æ˜ å°„ä¹Ÿæ­£ç¡®
  "resultSummary": "Wrote to test5jinkang.ts",
  "duration": 2
}
[18:54:43.732] ğŸ”§ Tool message updated {"messageId":"...","status":"success"}
```

**ç»“è®º**ï¼šçŠ¶æ€æ›´æ–°æ˜¯æ­£ç¡®çš„ï¼Œstore ä¸­çš„æ•°æ®å·²ç»æ˜¯ `success`ï¼Œä½† UI æ²¡æœ‰å“åº”æ›´æ–°ã€‚

### Core æ—¥å¿—

```log
[18:54:43.731] ğŸ“¡ [Event] tool:complete {
  "toolCallId": "call_00_0GijBgXdVt8pqhpT7YE2o5rs",
  "toolName": "WriteFile",
  "status": "success",
  "duration": 2,
  "resultSummary": "Wrote to test5jinkang.ts"
}
```

**ç»“è®º**ï¼šCore å±‚äº‹ä»¶å‘é€æ­£ç¡®ï¼ŒçŠ¶æ€ä¸º `success`ã€‚

## ç›¸å…³ä»£ç ä½ç½®

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `packages/cli/src/routes/session/index.tsx` | Session ç»„ä»¶ï¼Œä½¿ç”¨ `<Static>` æ¸²æŸ“æ¶ˆæ¯ |
| `packages/cli/src/context/store.tsx` | `useCompletedMessages()` hook |
| `packages/cli/src/hooks/useExecutionMessages.ts` | ç›‘å¬æ‰§è¡Œäº‹ä»¶ï¼Œæ›´æ–°æ¶ˆæ¯çŠ¶æ€ |
| `packages/cli/src/component/message-area/tool-message.tsx` | ToolMessage ç»„ä»¶ï¼Œæ ¹æ®çŠ¶æ€æ˜¾ç¤ºé¢œè‰² |

