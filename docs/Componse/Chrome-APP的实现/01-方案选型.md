# Chrome App Mode 方案选型

## 背景

在开发 CLI 终端应用时，终端 UI 的显示能力有限，无法完美展示：
- 图片预览
- 代码对比（Diff）
- TODO 看板
- 复杂的数据可视化

**核心需求：** CLI 作为主交互方式，桌面端作为辅助显示层，按需弹出。

---

## 技术方案对比

### 方案 1: Chrome App Mode ✅ 推荐

**原理：** 使用 `chrome --app=URL` 参数启动 Chrome，隐藏浏览器 UI

**架构：**
```
Node.js 后端 (Express)
    ↓ HTTP
Chrome 浏览器 (--app 模式)
    ↓ 渲染
网页界面 (HTML/CSS/JS)
```

**优势：**
- ✅ 开发难度极低（就是写网页）
- ✅ 零打包成本（无需编译）
- ✅ 调试方便（Chrome DevTools）
- ✅ 跨平台零成本（有 Chrome 就能用）
- ✅ 完美匹配 CLI 主导的交互模式
- ✅ 按需显示（CLI 触发才打开）
- ✅ 更新简单（改代码即可）

**劣势：**
- ❌ 依赖 Chrome 浏览器
- ❌ 无法独立安装到应用列表
- ❌ 系统集成能力有限（无托盘、无自启动）

---

### 方案 2: PWA (Progressive Web App)

**原理：** 可安装的网页应用

**优势：**
- ✅ 可以"安装"到桌面
- ✅ 离线工作能力
- ✅ 推送通知

**劣势：**
- ❌ 需要用户手动安装
- ❌ 不适合 CLI 自动控制
- ❌ 无法实现"按需显示"
- ❌ 需要额外配置（manifest + service worker）

---

### 方案 3: Tauri

**原理：** Rust 后端 + 系统 WebView 的桌面应用

**优势：**
- ✅ 独立可执行文件
- ✅ 体积小（~3-5MB）
- ✅ 完整的系统集成能力

**劣势：**
- ❌ 需要学习 Rust
- ❌ 开发周期长（1-2 天）
- ❌ 打包复杂（需要编译）
- ❌ 过度设计（对于 CLI 辅助显示场景）

---

### 方案 4: Electron

**原理：** Node.js + Chromium 的桌面应用

**优势：**
- ✅ 功能完整
- ✅ 生态成熟

**劣势：**
- ❌ 体积巨大（~100MB）
- ❌ 开发复杂度高
- ❌ 打包流程繁琐
- ❌ 严重过度设计

---

## 选型结论

**对于 CLI + 辅助桌面端的场景，Chrome App Mode + PWA 是最优解。**

### 核心理由

1. **开发成本最低**
   - 前端就是普通网页开发
   - 后端只需要一个简单的 Express 服务器
   - 添加 PWA 支持只需额外 1 小时
   - 总开发时间：3 小时

2. **完美匹配使用场景**
   ```bash
   # CLI 主导，桌面端辅助
   tm list              # 终端显示
   tm list --board      # 桌面端显示（按需）
   tm show 15 --visual  # 桌面端显示详情
   ```

3. **零学习成本**
   - 会写 HTML/CSS/JS 就能开发
   - 不需要学习新框架
   - 不需要学习打包工具

4. **迭代速度快**
   - 改代码 → 刷新浏览器 → 看效果
   - 无需重新编译
   - 无需重新打包

5. **未来可扩展**
   - 前端代码 100% 可复用
   - 如果未来需要独立应用，可以迁移到 Tauri
   - 迁移成本低（只需重写后端）

---

## 适用场景

### ✅ 适合 Chrome App Mode

- CLI 工具的辅助显示
- 开发者工具（目标用户肯定有 Chrome）
- 快速原型验证
- 内部工具
- 按需显示的场景

### ❌ 不适合 Chrome App Mode

- 需要独立桌面应用
- 需要分发给普通用户
- 需要系统托盘常驻
- 需要开机自启动
- 需要发布到应用商店

---

## 技术栈

```
后端：Express (Node.js)
前端：原生 HTML/CSS/JS
启动：child_process.exec
通信：HTTP 轮询（可选 WebSocket）
```

**代码量估算：**
- 后端：~100 行
- 前端：~200 行
- 总计：~300 行

---

## 开发时间估算

| 任务 | 时间 |
|------|------|
| 搭建 Express 服务器 | 10 分钟 |
| 实现 Chrome App 启动 | 5 分钟 |
| 前端框架搭建 | 30 分钟 |
| TODO 组件 | 15 分钟 |
| 图片预览组件 | 10 分钟 |
| Diff 组件 | 20 分钟 |
| CLI 集成 | 20 分钟 |
| **总计** | **~2 小时** |

---

## 总结

Chrome App Mode 是一个"恰到好处"的解决方案：
- 不像 PWA 那样功能不足
- 不像 Tauri/Electron 那样过度设计
- 完美平衡了开发成本和功能需求
- 最适合 CLI 工具的辅助显示场景
