# 命令系统实现文档

本目录包含 Reason CLI 命令系统的完整实现文档。

## 文档导航

### [01-实现总览](./01-实现总览.md)
项目背景、设计目标、实现阶段、技术栈和核心特性总览。

**适合**：想要快速了解命令系统整体设计的读者。

**主要内容**：
- 为什么要实现命令系统
- 核心特性和命令列表
- 实现阶段和文件结构
- 实现亮点和问题解决概要

### [02-核心架构设计](./02-核心架构设计.md)
深入讲解命令系统的架构设计、数据流和组件设计。

**适合**：想要理解系统内部工作原理的开发者。

**主要内容**：
- CommandRegistry 类设计
- 数据流设计（补全流程、执行流程）
- 组件架构（CommandComplete、CommandPanel、Prompt、InputArea）
- 键盘交互设计
- 类型安全和扩展性设计

### [03-使用指南](./03-使用指南.md)
面向用户和开发者的使用说明。

**适合**：
- 用户：学习如何使用命令系统
- 开发者：学习如何添加新命令和自定义面板

**主要内容**：
- 用户使用指南（基本操作、命令列表、使用技巧）
- 开发者指南（添加命令、创建面板、访问状态）
- 测试指南
- 性能优化建议
- 常见问题

### [04-实现细节与问题解决](./04-实现细节与问题解决.md)
开发过程中遇到的技术难点和解决方案。

**适合**：想要深入了解实现细节和最佳实践的开发者。

**主要内容**：
- Dialog 组件关闭机制
- 键盘事件冲突处理
- Instant 命令访问 Context 的问题
- 命令搜索性能优化
- TypeScript 类型推导
- 代码组织和测试策略
- 性能监控和调试技巧
- 已知问题和未来改进方向

## 快速开始

### 用户

1. 阅读 [01-实现总览](./01-实现总览.md) 了解背景
2. 阅读 [03-使用指南](./03-使用指南.md) 的"用户使用指南"部分

### 开发者

**想要添加新命令？**
1. 阅读 [03-使用指南](./03-使用指南.md) 的"添加新命令"部分
2. 参考 `packages/cli/src/component/command/commands.tsx`

**想要理解内部原理？**
1. 阅读 [02-核心架构设计](./02-核心架构设计.md)
2. 阅读 [04-实现细节与问题解决](./04-实现细节与问题解决.md)

**遇到问题？**
1. 查看 [03-使用指南](./03-使用指南.md) 的"常见问题"部分
2. 查看 [04-实现细节与问题解决](./04-实现细节与问题解决.md) 的"已知问题和限制"部分

## 核心概念

### 命令类型

- **Instant 命令**：立即执行，不显示面板（如 `/clear`、`/new`）
- **Panel 命令**：显示功能面板供用户交互（如 `/model`、`/session`）

### 交互模式

- **命令补全模式**：输入 `/` 触发，显示命令列表，支持模糊搜索
- **功能面板模式**：执行 Panel 命令后，面板替换输入框位置显示

### 关键组件

- **CommandRegistry**：命令注册表，管理所有命令
- **CommandComplete**：命令补全面板组件
- **CommandPanel**：功能面板容器组件
- **Prompt**：输入框组件（已修改，支持命令模式）
- **InputArea**：输入区域组件（已修改，支持命令面板）

## 文件位置

### 核心文件

```
packages/cli/src/
├── component/
│   ├── command/
│   │   ├── command-registry.ts      # 命令注册系统
│   │   ├── command-complete.tsx     # 命令补全组件
│   │   ├── command-panel.tsx        # 功能面板容器
│   │   ├── commands.tsx             # 命令定义 ⭐ 添加新命令在这里
│   │   └── index.ts                 # 导出
│   ├── dialog-model.tsx             # 模型选择面板
│   ├── dialog-session-list.tsx      # 会话列表面板
│   ├── dialog-session-rename.tsx    # 会话重命名面板
│   ├── dialog-theme.tsx             # 主题选择面板
│   ├── dialog-help.tsx              # 帮助面板
│   └── prompt/
│       └── index.tsx                # 输入框（已修改）
└── routes/
    └── session/
        ├── inputArea.tsx            # 输入区域（已修改）
        └── index.tsx                # 会话页面
```

### 文档文件

```
docs/Componse/命令系统实现/
├── README.md                                    # 本文件
├── 01-实现总览.md                               # 总览
├── 02-核心架构设计.md                           # 架构设计
├── 03-使用指南.md                               # 使用指南
└── 04-实现细节与问题解决.md                     # 实现细节
```

## 实现统计

### 代码量

- 新增文件：5 个
- 修改文件：4 个
- 删除文件：4 个
- 核心代码：约 800 行

### 实现时间

- Phase 1（MVP）：完成
- Phase 2（功能完善）：完成
- Phase 3（清理优化）：完成
- 总耗时：约 4 小时

### 测试覆盖

- 手动测试：✅ 完成
- 单元测试：⏳ 计划中
- 集成测试：⏳ 计划中

## 已实现命令

| 命令 | 类型 | 分类 | 描述 |
|------|------|------|------|
| `/model` | Panel | Model | 选择 AI 模型 |
| `/session` | Panel | Session | 查看和切换会话 |
| `/new` | Instant | Session | 创建新会话 |
| `/rename` | Panel | Session | 重命名当前会话 |
| `/theme` | Panel | Appearance | 选择主题 |
| `/clear` | Instant | System | 清空终端 |
| `/help` | Panel | System | 显示所有命令 |

## 技术栈

- **React 18** - UI 框架
- **Ink** - 终端 UI 库
- **TypeScript 5.8** - 类型系统
- **Zustand** - 状态管理
- **fuzzysort** - 模糊搜索

## 贡献

欢迎贡献新命令、改进建议和 Bug 修复！

**添加新命令**：
1. 编辑 `packages/cli/src/component/command/commands.tsx`
2. 遵循现有命令的格式
3. 测试命令执行
4. 更新本文档

**报告问题**：
- 在 GitHub Issues 中创建新 issue
- 描述问题和复现步骤
- 附上错误信息和截图

## 许可

本项目遵循 MIT 许可证。

## 联系方式

如有问题或建议，请通过以下方式联系：
- GitHub Issues
- 项目维护者邮箱

---

**最后更新**：2024-12-25
**文档版本**：1.0.0
**代码版本**：见 package.json
