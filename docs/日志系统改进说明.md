# æ—¥å¿—ç³»ç»Ÿæ”¹è¿›è¯´æ˜

## ğŸ“ æ”¹è¿›æ€»ç»“

### 1. é…ç½®ç³»ç»Ÿ
- âœ… åˆ›å»ºäº† `logger.config.json` é…ç½®æ–‡ä»¶
- âœ… åˆ›å»ºäº† `logger.config.example.json` ç¤ºä¾‹æ¨¡æ¿
- âœ… æ·»åŠ åˆ° `.gitignore`ï¼ˆæ¯ä¸ªå¼€å‘è€…å¯è‡ªå®šä¹‰ï¼‰

### 2. æ—¥å¿—å°è£…
- âœ… Core: `packages/core/src/utils/logUtils.ts`
- âœ… CLI: `packages/cli/src/util/logUtils.ts`

### 3. é…ç½®åŠ è½½
- âœ… Core Logger æ”¯æŒé…ç½®æ–‡ä»¶å’Œç¯å¢ƒå˜é‡
- âœ… CLI Logger æ”¯æŒé…ç½®æ–‡ä»¶å’Œç¯å¢ƒå˜é‡
- âœ… app.tsx å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½é…ç½®

### 4. é…ç½®ä¼˜å…ˆçº§
```
ç¯å¢ƒå˜é‡ > é…ç½®æ–‡ä»¶ > ä»£ç é»˜è®¤å€¼
```

## ğŸ¯ ä½¿ç”¨æ–¹å¼

### å¼€å‘ç¯å¢ƒï¼ˆè¯¦ç»†æ—¥å¿—ï¼‰
```bash
# æ–¹å¼ 1ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰
# ç¼–è¾‘ logger.config.json
{
  "enabled": true,
  "minLevel": "DEBUG",
  "retentionDays": 7,
  "bufferSize": 20
}

# å¯åŠ¨
bun run dev
```

### ç”Ÿäº§ç¯å¢ƒï¼ˆç®€æ´æ—¥å¿—ï¼‰
```bash
# æ–¹å¼ 1ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶
# ç¼–è¾‘ logger.config.json
{
  "enabled": true,
  "minLevel": "INFO",
  "retentionDays": 3,
  "bufferSize": 50
}

# æ–¹å¼ 2ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆä¸´æ—¶è¦†ç›–ï¼‰
LOG_LEVEL=INFO bun run dev
```

### è°ƒè¯•ç‰¹å®šé—®é¢˜ï¼ˆä¸´æ—¶åˆ‡æ¢ï¼‰
```bash
# ä¸´æ—¶å¼€å¯ DEBUG æ—¥å¿—
LOG_LEVEL=DEBUG bun run dev

# å®Œå…¨å…³é—­æ—¥å¿—
LOG_ENABLED=false bun run dev
```

## ğŸ“Š æ—¥å¿—çº§åˆ«è¯´æ˜

### DEBUG çº§åˆ«
- **ç”¨é€”**ï¼šå¼€å‘è°ƒè¯•å’Œç®—æ³•éªŒè¯
- **å†…å®¹**ï¼šå®Œæ•´æ•°æ®ï¼Œä¸æˆªæ–­
- **ç¤ºä¾‹**ï¼š
  - å·¥å…·å®Œæ•´å‚æ•°å’Œè¾“å‡º
  - LLM å®Œæ•´è¯·æ±‚å’Œå“åº”
  - ä¸Šä¸‹æ–‡å®Œæ•´æ¶ˆæ¯åˆ—è¡¨
  - å‹ç¼©å‰åçš„å®Œæ•´æ•°æ®

### INFO çº§åˆ«
- **ç”¨é€”**ï¼šç”Ÿäº§ç¯å¢ƒï¼Œè®°å½•æ‰§è¡Œæµç¨‹
- **å†…å®¹**ï¼šå…³é”®é‡Œç¨‹ç¢‘ï¼Œè‡ªåŠ¨æˆªæ–­
- **ç¤ºä¾‹**ï¼š
  - å·¥å…·æ‰§è¡Œå¼€å§‹/å®Œæˆ
  - LLM è°ƒç”¨ç»Ÿè®¡
  - å¾ªç¯æ€»ç»“
  - ä¼šè¯ä¿å­˜

### WARN çº§åˆ«
- **ç”¨é€”**ï¼šè­¦å‘Šå’Œé‡è¦å†³ç­–
- **å†…å®¹**ï¼šè§¦å‘ç‰¹æ®Šé€»è¾‘
- **ç¤ºä¾‹**ï¼š
  - ä¸Šä¸‹æ–‡å‹ç¼©è§¦å‘
  - å·¥å…·è¾“å‡ºè¢«å‹ç¼©
  - é…ç½®ä½¿ç”¨é»˜è®¤å€¼

### ERROR çº§åˆ«
- **ç”¨é€”**ï¼šé”™è¯¯å’Œå¤±è´¥
- **å†…å®¹**ï¼šé”™è¯¯è¯¦æƒ…å’Œä¸Šä¸‹æ–‡
- **ç¤ºä¾‹**ï¼š
  - å·¥å…·æ‰§è¡Œå¤±è´¥
  - LLM è°ƒç”¨å¤±è´¥
  - ä¸Šä¸‹æ–‡æº¢å‡º

## ğŸ”§ ä»£ç ä½¿ç”¨ç¤ºä¾‹

### Core åŒ…
```typescript
import { toolLogger, contextLogger, llmLogger, loopLogger } from './utils/logUtils.js';

// å·¥å…·æ—¥å¿—
toolLogger.execute(toolName, callId, args);
toolLogger.rawOutput(toolName, callId, output);
toolLogger.compressed(toolName, callId, originalOutput, originalTokens, processedOutput, processedTokens);
toolLogger.complete(toolName, callId, duration);
toolLogger.error(toolName, callId, error, args);

// ä¸Šä¸‹æ–‡æ—¥å¿—
contextLogger.state(messageCount, tokens, limit, messages);
contextLogger.compressionTriggered(usagePercent, totalMessages, tokens);
contextLogger.compressionDetails(beforeMessages, beforeTokens, afterMessages, afterTokens);

// LLM æ—¥å¿—
llmLogger.request(messageCount, toolCount, tools, messages);
llmLogger.response(finishReason, content, thinkingContent, toolCalls, usage);
llmLogger.error(error, attempt, maxRetries);

// å¾ªç¯æ—¥å¿—
loopLogger.start(maxLoops, enableCompression);
loopLogger.iteration(loopCount, maxLoops);
loopLogger.complete(loopCount, totalTokens);
loopLogger.error(loopCount, error);
```

### CLI åŒ…
```typescript
import {
  appLogger,
  sessionLogger,
  agentLogger,
  eventLogger,
  executionLogger,
  configLogger
} from './util/logUtils.js';

// åº”ç”¨æ—¥å¿—
appLogger.start(platform, nodeVersion, cwd);
appLogger.shutdown(reason);

// ä¼šè¯æ—¥å¿—
sessionLogger.load(sessionCount, currentSessionId);
sessionLogger.save(sessionId, totalMessages, assistantMessages, withMetadata);

// Agent æ—¥å¿—
agentLogger.init(provider, model, sessionId);
agentLogger.sendMessage(messageId, content);
```

## ğŸ“‹ å¾…ä¿®æ”¹æ–‡ä»¶æ¸…å•

### Core åŒ…
- [x] packages/core/src/utils/logger.ts - æ‰©å±•é…ç½®åŠ è½½
- [x] packages/core/src/utils/logUtils.ts - åˆ›å»ºå°è£…
- [ ] packages/core/src/core/tool/ToolScheduler.ts
- [ ] packages/core/src/core/llm/utils/executeToolLoop.ts
- [ ] packages/core/src/core/llm/utils/executeToolLoopUtils.ts
- [ ] packages/core/src/core/execution/ExecutionStreamManager.ts

### CLI åŒ…
- [x] packages/cli/src/util/logger.ts - æ‰©å±•é…ç½®åŠ è½½
- [x] packages/cli/src/util/logUtils.ts - åˆ›å»ºå°è£…
- [x] packages/cli/src/app.tsx - åˆå§‹åŒ–æ—¥å¿—
- [ ] packages/cli/src/routes/session/inputArea.tsx
- [ ] packages/cli/src/hooks/useAgent.ts
- [ ] packages/cli/src/hooks/usePersistence.ts
- [ ] packages/cli/src/context/execution.tsx
- [ ] packages/cli/src/config/manager.ts

### åˆ é™¤æ— ç”¨æ—¥å¿—
- [ ] åˆ é™¤æ‰€æœ‰ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ—¥å¿—
- [ ] åˆ é™¤ä¸Šä¸‹æ–‡æ¨¡å—çš„é«˜é¢‘æ“ä½œæ—¥å¿—

## ğŸ‰ ä¼˜åŠ¿

1. **é…ç½®ç®€å•**ï¼šåªéœ€ä¸€è¡Œ `minLevel: "DEBUG"` æˆ– `"INFO"`
2. **ä»£ç å¹²å‡€**ï¼šä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œæ¸…æ™°æ˜äº†
3. **åˆ‡æ¢æ–¹ä¾¿**ï¼šæ”¹é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡ï¼Œç«‹å³ç”Ÿæ•ˆ
4. **é›¶åˆ é™¤**ï¼šä»£ç æ°¸è¿œä¿ç•™ï¼Œåªæ˜¯é€šè¿‡çº§åˆ«æ§åˆ¶
5. **DEBUG å®Œæ•´**ï¼šæ‰€æœ‰æ•°æ®å®Œæ•´è®°å½•ï¼Œç”¨äºéªŒè¯ç®—æ³•
6. **INFO ç®€æ´**ï¼šåªè®°å½•æµç¨‹ï¼Œè‡ªåŠ¨æˆªæ–­é•¿å†…å®¹

---

# ğŸ“Œ æ–¹æ¡ˆ2å®æ–½ï¼šä¸åŒç»´åº¦çš„æ—¥å¿—è®°å½•ï¼ˆ2026-01-06ï¼‰

## ğŸ¯ å®æ–½èƒŒæ™¯

åœ¨å®é™…ä½¿ç”¨ä¸­å‘ç°ï¼ŒINFO å’Œ DEBUG æ—¥å¿—å­˜åœ¨é‡å¤é—®é¢˜ï¼š
- å¯ç”¨ DEBUG æ—¶ï¼ŒåŒä¸€äº‹ä»¶è¢«è®°å½•ä¸¤æ¬¡
- INFO æ˜¯ DEBUG çš„ç®€åŒ–ç‰ˆï¼Œå¯¼è‡´æ—¥å¿—æ–‡ä»¶å……æ–¥é‡å¤ä¿¡æ¯

## ğŸ’¡ æ–¹æ¡ˆ2æ ¸å¿ƒæ€æƒ³

```
INFO â‰  DEBUGçš„ç®€åŒ–ç‰ˆ
INFO = ç”¨æˆ·è§†è§’çš„å…³é”®äº‹ä»¶ï¼ˆå®Œæˆäº†ä»€ä¹ˆï¼‰
DEBUG = å¼€å‘è€…è§†è§’çš„æŠ€æœ¯ç»†èŠ‚ï¼ˆå…·ä½“æ€ä¹ˆåšçš„ï¼‰
```

**å¯ç”¨ DEBUG æ—¶ï¼ŒINFO + DEBUG äº’è¡¥è€Œéé‡å¤**

## âœ… å®æ–½å†…å®¹

### 1. æ›´æ–°æ—¥å¿—è®¾è®¡åŸåˆ™

**ä¿®æ”¹æ–‡ä»¶**ï¼š`packages/core/src/utils/logUtils.ts`

**æ–°åŸåˆ™**ï¼š
- INFOï¼šå…³é”®é‡Œç¨‹ç¢‘ï¼ˆSessionå¼€å§‹ã€Loopå®Œæˆã€Toolå®Œæˆã€é”™è¯¯/è­¦å‘Šï¼‰
- DEBUGï¼šæŠ€æœ¯ç»†èŠ‚ï¼ˆäº‹ä»¶å‘å°„ã€å·¥å…·æ‰§è¡Œå‚æ•°ã€LLMè°ƒç”¨è¯¦æƒ…ã€å®Œæ•´è¾“å‡ºï¼‰
- WARNï¼šè­¦å‘Šå’Œé‡è¦å†³ç­–ï¼ˆå¦‚å‹ç¼©è§¦å‘ï¼‰
- ERRORï¼šé”™è¯¯å’Œå¤±è´¥

### 2. åˆ é™¤é‡å¤çš„ INFO æ—¥å¿—

| å‡½æ•° | åˆ é™¤çš„æ—¥å¿— | åŸå›  |
|------|-----------|------|
| `toolLogger.execute` | âŒ `logger.info('[Tool] started')` | DEBUG å·²è®°å½•æŠ€æœ¯ç»†èŠ‚ |
| `toolLogger.rawOutput` | âŒ `logger.info('[Tool] output')` | DEBUG å·²è®°å½•å®Œæ•´è¾“å‡º |
| `eventLogger.emit` | âŒ `logger.info('[Event] xxx')` | DEBUG å·²è®°å½•äº‹ä»¶è¯¦æƒ… |
| `contextLogger.state` | âŒ `logger.info('[Context] State')` | DEBUG å·²è®°å½•å®Œæ•´çŠ¶æ€ |
| `llmLogger.request` | âŒ `logger.info('[LLM] Request')` | DEBUG å·²è®°å½•è¯·æ±‚è¯¦æƒ… |
| `llmLogger.response` | âŒ `logger.info('[LLM] Response')` | DEBUG å·²è®°å½•å“åº”è¯¦æƒ… |

### 3. ä¿ç•™çš„ INFO æ—¥å¿—

| å‡½æ•° | ä¿ç•™çš„æ—¥å¿— | åŸå›  |
|------|-----------|------|
| `toolLogger.complete` | âœ… `logger.info('[Tool] completed')` | å…³é”®é‡Œç¨‹ç¢‘ |
| `toolLogger.error` | âœ… `logger.error('[Tool] failed')` | é”™è¯¯å¿…è®° |
| `loopLogger.start` | âœ… `logger.info('[Loop] Started')` | å…³é”®é‡Œç¨‹ç¢‘ |
| `loopLogger.complete` | âœ… `logger.info('[Loop] Completed')` | å…³é”®é‡Œç¨‹ç¢‘ |

## ğŸ“Š æ•ˆæœå¯¹æ¯”

### æ”¹è¿›å‰ï¼ˆæ—§è®¾è®¡ï¼‰

**DEBUG çº§åˆ«è¾“å‡º**ï¼š
```log
[DEBUG] ğŸ”§ [Tool:Execute] ReadFile {"callId":"xxx","args":{...}}
[INFO] ğŸ”§ [Tool] ReadFile started {"callId":"xxx"}  â† é‡å¤ï¼

[DEBUG] ğŸ“¤ [Tool:RawOutput] ReadFile {"output":"..."}
[INFO] ğŸ“¤ [Tool] ReadFile output {"preview":"..."}  â† é‡å¤ï¼

[DEBUG] ğŸ“¡ [Event:Emit] tool:complete {...}
[INFO] ğŸ“¡ [Event] tool:complete  â† é‡å¤ï¼
```

**é—®é¢˜**ï¼šåŒä¸€äº‹ä»¶è¢«è®°å½•å¤šæ¬¡

### æ”¹è¿›åï¼ˆæ–°è®¾è®¡ï¼‰

**INFO çº§åˆ«è¾“å‡º**ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ï¼š
```log
[INFO] ğŸš€ [Loop] Started
[INFO] âœ… [Tool] TodoWrite completed in 1ms
[INFO] âœ… [Tool] ListFiles completed in 2ms
[INFO] âœ… [Loop] Completed - 10 iterations, 6472 tokens
```

**DEBUG çº§åˆ«è¾“å‡º**ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ï¼š
```log
[INFO] ğŸš€ [Loop] Started  â† å…³é”®é‡Œç¨‹ç¢‘
[DEBUG] ğŸ”„ [Loop] Iteration 1/10  â† æŠ€æœ¯ç»†èŠ‚
[DEBUG] ğŸ“¡ [Event:Emit] thinking:start  â† æŠ€æœ¯ç»†èŠ‚
[DEBUG] ğŸ”§ [Tool:Execute] TodoWrite {"args":{...}}  â† æŠ€æœ¯ç»†èŠ‚
[DEBUG] ğŸ“¤ [Tool:RawOutput] TodoWrite {"output":"..."}  â† æŠ€æœ¯ç»†èŠ‚
[INFO] âœ… [Tool] TodoWrite completed  â† å…³é”®é‡Œç¨‹ç¢‘
[INFO] âœ… [Loop] Completed  â† å…³é”®é‡Œç¨‹ç¢‘
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ²¡æœ‰é‡å¤ä¿¡æ¯
- âœ… INFO å’Œ DEBUG å„å¸å…¶èŒ
- âœ… å¯ç”¨ DEBUG æ—¶è·å¾—å®Œæ•´è§†å›¾

## ğŸ§ª éªŒè¯æ–¹æ³•

### 1. æµ‹è¯• INFO çº§åˆ«

åˆ›å»º `logger.config.json`ï¼š
```json
{
  "enabled": true,
  "minLevel": "INFO"
}
```

è¿è¡Œå¹¶æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
bun run --cwd packages/cli dev
cat logs/core/core-[timestamp].log
```

**é¢„æœŸ**ï¼šåªçœ‹åˆ°å…³é”®é‡Œç¨‹ç¢‘ï¼ˆLoop Started/Completedã€Tool completedï¼‰

### 2. æµ‹è¯• DEBUG çº§åˆ«

ä¿®æ”¹ `logger.config.json`ï¼š
```json
{
  "enabled": true,
  "minLevel": "DEBUG"
}
```

è¿è¡Œå¹¶æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
bun run --cwd packages/cli dev
cat logs/core/core-[timestamp].log
```

**é¢„æœŸ**ï¼š
- çœ‹åˆ°æ‰€æœ‰ INFO æ—¥å¿—ï¼ˆå…³é”®é‡Œç¨‹ç¢‘ï¼‰
- çœ‹åˆ°æ‰€æœ‰ DEBUG æ—¥å¿—ï¼ˆæŠ€æœ¯ç»†èŠ‚ï¼‰
- **æ²¡æœ‰é‡å¤ä¿¡æ¯**

## ğŸ“ˆ æ”¹è¿›æ•ˆæœ

| ç»´åº¦ | æ”¹è¿›å‰ | æ”¹è¿›å |
|------|--------|--------|
| DEBUG æ—¶é‡å¤ | âŒ ä¸¥é‡é‡å¤ | âœ… æ— é‡å¤ |
| INFO æ—¥å¿—é‡ | ä¸­ç­‰ | å¾ˆå°‘ |
| DEBUG æ—¥å¿—é‡ | å¤š | å¾ˆå¤š |
| INFO æ¸…æ™°åº¦ | ä¸€èˆ¬ | âœ… éå¸¸æ¸…æ™° |
| DEBUG å®Œæ•´æ€§ | âœ… å®Œæ•´ | âœ… å®Œæ•´ |
| ç»´æŠ¤æˆæœ¬ | é«˜ï¼ˆéœ€åŒæ­¥ç»´æŠ¤ï¼‰ | ä½ï¼ˆç‹¬ç«‹ç»´æŠ¤ï¼‰ |

## ğŸ¯ ä½¿ç”¨å»ºè®®

### åœºæ™¯æ¨è

| åœºæ™¯ | çº§åˆ« | ç†ç”± |
|------|------|------|
| æ—¥å¸¸å¼€å‘ | DEBUG | éœ€è¦å®Œæ•´æŠ€æœ¯ç»†èŠ‚ |
| åŠŸèƒ½æµ‹è¯• | INFO | éªŒè¯å…³é”®æµç¨‹å³å¯ |
| æ€§èƒ½æµ‹è¯• | INFO | å‡å°‘æ—¥å¿—å¼€é”€ |
| ç”Ÿäº§éƒ¨ç½² | INFO | è½»é‡ç›‘æ§ |
| é—®é¢˜è¯Šæ–­ | DEBUG | éœ€è¦å®Œæ•´è¯Šæ–­ä¿¡æ¯ |

## ğŸ’» ä¿®æ”¹æ–‡ä»¶

- âœ… `packages/core/src/utils/logUtils.ts` - åˆ é™¤é‡å¤çš„ INFO æ—¥å¿—
- âœ… æ›´æ–°æ–‡ä»¶å¤´æ³¨é‡Šï¼Œè¯´æ˜æ–°çš„è®¾è®¡åŸåˆ™

## ğŸ‰ ç»“è®º

æ–¹æ¡ˆ2æˆåŠŸå®æ–½ï¼ç°åœ¨çš„æ—¥å¿—ç³»ç»Ÿï¼š
1. **INFO çº§åˆ«**ï¼šæ¸…æ™°ç®€æ´ï¼Œåªæœ‰å…³é”®é‡Œç¨‹ç¢‘
2. **DEBUG çº§åˆ«**ï¼šå®Œæ•´è¯¦ç»†ï¼ŒåŒ…å«æ‰€æœ‰æŠ€æœ¯ç»†èŠ‚
3. **æ— é‡å¤**ï¼šä¸¤è€…äº’è¡¥ï¼Œä¸å†é‡å¤è®°å½•åŒä¸€äº‹ä»¶
4. **çµæ´»**ï¼šæ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„æ—¥å¿—çº§åˆ«
